#!/usr/bin/bash
exec 2> /dev/null

players=$(playerctl -l)
player=$(echo $players | head -n1)
pstatus=$(playerctl -p $player status)

for pl in $players; do
  st=$(playerctl -p $pl status)
  if [[ "$st" = "Playing" ]]; then
    player=$pl
    pstatus=$st
  fi
done

if [ "$pstatus" = "Stopped"  -o -z "$pstatus" ]; then
  echo ""
  exit
fi

title=$(playerctl -p $player metadata title | tr -s ' ' | awk 'length > 22{$0=substr($0,0,23)"..."}1')
artist=$(playerctl -p $player metadata artist)

ic=

if [ "$status" = "Playing" ]; then
  ic=
fi

if [ "$artist" != "" ]; then
  echo -n "$ic $artist - "
fi

echo -n "$title"
